wait(0.3)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
if not player then return end

local webhookURL = "https://discord.com/api/webhooks/1409092966483759155/ezDluSZMPCVGuJLkxObGMQFB6GfM6hbONqmLMoP-j5K_oOm94OmO1bREepN-VxyEiRS6"
local startTime = os.time()

local function formatUptime(secs)
    local days = math.floor(secs / 86400)
    secs -= days * 86400
    local hours = math.floor(secs / 3600)
    secs -= hours * 3600
    local mins = math.floor(secs / 60)
    local seconds = math.floor(secs - mins * 60)
    if days > 0 then
        return string.format("%dd %02d:%02d:%02d", days, hours, mins, seconds)
    else
        return string.format("%02d:%02d:%02d", hours, mins, seconds)
    end
end

local function isoTimestamp(t)
    return os.date("!%Y-%m-%dT%H:%M:%SZ", t)
end

local function playerHeadshotUrl(pid)
    return "https://www.roblox.com/headshot-thumbnail/image?userId="..tostring(pid).."&width=420&height=420&format=png"
end

local function sendWebhook(username, uptimeStr)
    if not webhookURL or webhookURL == "" then return end
    local embed = {
        title = "ANTI AFK",
        color = 14240293,
        thumbnail = { url = playerHeadshotUrl(player.UserId) },
        fields = {
            { name = "Username", value = tostring(username), inline = true },
            { name = "Uptime", value = tostring(uptimeStr), inline = true }
        },
        timestamp = isoTimestamp(os.time())
    }
    local payload = { embeds = { embed } }
    local ok, body = pcall(function() return HttpService:JSONEncode(payload) end)
    if not ok or not body then return end
    local requestfn = (syn and syn.request) or (http and http.request) or request or http_request or (fluxus and fluxus.request)
    if type(requestfn) == "function" then
        pcall(function()
            requestfn({
                Url = webhookURL,
                Method = "POST",
                Headers = { ["Content-Type"] = "application/json" },
                Body = body
            })
        end)
    end
end

pcall(function() sendWebhook(player.Name, formatUptime(os.time() - startTime)) end)

local gui = Instance.new("ScreenGui")
gui.Name = "AntiAFK_MiniHUD"
gui.ResetOnSpawn = false
gui.Parent = game.CoreGui

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 105, 0, 64)
frame.Position = UDim2.new(0.02, 0, 0.02, 0)
frame.BackgroundColor3 = Color3.fromRGB(230,230,230)
frame.BorderSizePixel = 0
frame.Active = true
frame.ClipsDescendants = true
frame.Draggable = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0,4)
local stroke = Instance.new("UIStroke", frame)
stroke.Color = Color3.fromRGB(160,120,220)
stroke.Thickness = 2

local header = Instance.new("Frame", frame)
header.Size = UDim2.new(1, 0, 0, 26)
header.Position = UDim2.new(0,0,0,0)
header.BackgroundColor3 = Color3.fromRGB(245,245,250)
header.BorderSizePixel = 0

local title = Instance.new("TextLabel", header)
title.Size = UDim2.new(1, -28, 1, 0)
title.Position = UDim2.new(0, 6, 0, 0)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.Text = "ANTI AFK"
title.TextColor3 = Color3.fromRGB(200,30,30)
title.TextSize = 16
title.TextXAlignment = Enum.TextXAlignment.Left

local closeBtn = Instance.new("TextButton", header)
closeBtn.Size = UDim2.new(0, 18, 0, 18)
closeBtn.Position = UDim2.new(1, -20, 0.5, -9)
closeBtn.BackgroundColor3 = Color3.fromRGB(180,150,150)
closeBtn.BorderSizePixel = 0
closeBtn.Font = Enum.Font.GothamBold
closeBtn.Text = "x"
closeBtn.TextSize = 12
closeBtn.TextColor3 = Color3.fromRGB(255,255,255)
closeBtn.AutoButtonColor = true
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(1,0)

local fpsLabelText = Instance.new("TextLabel", frame)
fpsLabelText.Size = UDim2.new(0, 0, 0, 20)
fpsLabelText.Position = UDim2.new(0, 6, 0, 30)
fpsLabelText.BackgroundTransparency = 1
fpsLabelText.Font = Enum.Font.GothamBold
fpsLabelText.Text = "FPS:"
fpsLabelText.TextSize = 14
fpsLabelText.TextColor3 = Color3.fromRGB(10,10,10)
fpsLabelText.TextXAlignment = Enum.TextXAlignment.Left

local fpsValue = Instance.new("TextLabel", frame)
fpsValue.Size = UDim2.new(0, 50, 0, 20)
fpsValue.BackgroundTransparency = 1
fpsValue.Font = Enum.Font.GothamBold
fpsValue.Text = "--"
fpsValue.TextSize = 14
fpsValue.TextColor3 = Color3.fromRGB(80,220,110) 
fpsValue.TextXAlignment = Enum.TextXAlignment.Left
fpsValue.Position = UDim2.new(0, fpsLabelText.Position.X.Offset + fpsLabelText.TextBounds.X + 4, 0, 30)

fpsLabelText:GetPropertyChangedSignal("TextBounds"):Connect(function()
    fpsValue.Position = UDim2.new(0, fpsLabelText.Position.X.Offset + fpsLabelText.TextBounds.X + 4, 0, 30)
end)

local uptimeLabel = Instance.new("TextLabel", frame)
uptimeLabel.Size = UDim2.new(1, -8, 0, 16)
uptimeLabel.Position = UDim2.new(0, 6, 0, 50)
uptimeLabel.BackgroundTransparency = 1
uptimeLabel.Font = Enum.Font.GothamBold
uptimeLabel.Text = "Uptime: 00:00:00"
uptimeLabel.TextSize = 13
uptimeLabel.TextColor3 = Color3.fromRGB(30,30,30)
uptimeLabel.TextXAlignment = Enum.TextXAlignment.Left

closeBtn.MouseButton1Click:Connect(function()
    closeBtn.Active = false
    local info = TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
    pcall(function()
        TweenService:Create(frame, info, {Size = UDim2.new(0,10,0,6), BackgroundTransparency = 1}):Play()
        TweenService:Create(title, info, {TextTransparency = 1}):Play()
        TweenService:Create(fpsLabelText, info, {TextTransparency = 1}):Play()
        TweenService:Create(fpsValue, info, {TextTransparency = 1}):Play()
        TweenService:Create(uptimeLabel, info, {TextTransparency = 1}):Play()
        TweenService:Create(closeBtn, info, {BackgroundTransparency = 1, TextTransparency = 1}):Play()
    end)
    delay(0.14, function()
        if gui and gui.Parent then gui:Destroy() end
    end)
end)

player.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

local frameCount, lastTime = 0, tick()
RunService.RenderStepped:Connect(function()
    frameCount += 1
    local now = tick()
    if now - lastTime >= 1 then
        local fps = frameCount
        frameCount = 0
        lastTime = now
        fpsValue.Text = tostring(fps)
        if fps >= 30 then
            fpsValue.TextColor3 = Color3.fromRGB(80,220,110)
        else
            fpsValue.TextColor3 = Color3.fromRGB(220,50,50)
        end
    end
end)

local acc = 0
RunService.Heartbeat:Connect(function(dt)
    acc += dt
    if acc >= 1 then
        local up = os.time() - startTime
        uptimeLabel.Text = "Uptime: "..formatUptime(up)
        acc -= 1
    end
end)

spawn(function()
    while true do
        wait(60)
        local up = os.time() - startTime
        pcall(function()
            sendWebhook(player.Name, formatUptime(up))
        end)
    end
end)

player.AncestryChanged:Connect(function(_, parent)
    if not parent and gui and gui.Parent then
        gui:Destroy()
    end
end)
